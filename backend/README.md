# ⚙️ 後端系統與自動化維護指南

本目錄包含系統的核心 API 與所有輔助資料管理的自動化腳本。本專案採用 **Google Apps Script (GAS)** 提供 RESTful 服務，並搭配 **Python** 進行繁瑣的資料建置與更新工作。

---

## 📂 檔案結構說明

### 1. 核心 API (GAS)
- **`Code.gs`**：API 的大腦。負責處理前端的搜尋、登入、心得提交、瀏覽記錄計算等請求。
- **`Config.gs`**：私密配置區。定義了 Google Sheet ID、搜尋靈敏度與 API 金鑰等關鍵參數。

### 2. 資料庫管理工具 (GAS)
- **`gas/database_manager.gs`**：**「動態資料庫管理員」**。
    - 監聽 Google Sheet 的編輯事件 (`onEdit`)。
    - **自動連動**：在 Excel 中選擇母分類後，自動更新子分類與課程清單的下拉選單。
    - **審核流轉**：在「課程評鑑回覆」勾選後，自動將內容轉移至正確的資料庫分頁並給予顏色標記。

### 3. 自動化維護腳本 (Python)
- **`scripts/data_crawler.py`**：**「資料採集員」**。
    - 對接校務系統 API，自動抓取當學期最新的課程代碼、名稱與教師。
    - 產出 `課程資料.xlsx`，供維護者直接匯入 Google Sheets。
- **`scripts/sheets_builder.py`**：**「結構建置員」**。
    - 一鍵生成符合系統格式規範的 Excel 模板。
    - 當需要重建資料庫或更換試算表時，可確保所有分頁與表頭完全正確。

---

## 🛠️ 維護操作流程

### 情境 A：每學期初更新課程清單
1. 執行 `python scripts/data_crawler.py`。
2. 輸入目標學期代碼。
3. 將產生的 `課程資料.xlsx` 內容複製到 Google Sheets 的 **「課程資料庫」** 分頁。

### 情境 B：審核學弟妹提交的心得
1. 開啟 Google Sheets 轉至 **「課程評鑑回覆」**。
2. 檢查是否有謾罵或不實內容。
3. 勾選第一欄的 **「核准並移動」**。
4. **結果**：GAS 會自動將心得移至 **「評鑑資料庫」**，該項目背景會變為綠色，並即時反映在前端頁面上。

---

## 🧪 開發與測試
- **API 測試**：可直接在瀏覽器輸入 `WEB_APP_URL?action=getHotCourses` 確認回傳是否為 JSON。
- **資料連動測試**：在試算表中隨意修改資料，確認 UI 渲染是否即時更新。

---

## ⚠️ 重要規範
- **請勿合併檔案**：在 GAS 編輯器中請保持 `Code.gs` 與 `Config.gs` 獨立。
- **權限設定**：部署 Web App 時，請務必設定「執行身分：我」、「存取權限：任何人」。
- **備份建議**：雖然有自動化工具，建議每月手動下載一次 Google Sheet 作為冷備份。

---

© 2026 長庚中醫系學會維護小組
